# ğŸ“… Plan EstratÃ©gico - DÃ­a 2025-11-10

**Objetivo**: Completar integraciÃ³n backend real y testing E2E

**DuraciÃ³n estimada**: 4-6 horas

**Estado actual**: âœ… Week 1 completa (Security + Frontend + Docs)

---

## ğŸ¯ Objetivos del DÃ­a

1. âœ… **Supabase 100% funcional** (testing real con signup/login)
2. ğŸš€ **Integrar eco-packer** en Netlify Functions
3. ğŸ§ª **Testing E2E** del flujo completo
4. ğŸ“¦ **Deploy a staging** (opcional si todo funciona)

---

## â° Timeline Sugerido

### **SesiÃ³n 1: Supabase Configuration (1-2 horas)** â˜• MaÃ±ana

**Prioridad**: ğŸ”¥ CRÃTICA

**Tareas**:
- [ ] Ejecutar `001_core_schema.sql` en Supabase SQL Editor
- [ ] Ejecutar `002_storage_policies.sql`
- [ ] Crear 5 buckets (eco-files, ecox-files, nda-signatures, proofs, temp-uploads)
- [ ] Configurar SMTP (Gmail para empezar rÃ¡pido)
- [ ] Copiar credenciales a `client/.env`
- [ ] Testing: Signup â†’ Email â†’ Login â†’ Dashboard

**Archivos a usar**:
- `SUPABASE-QUICK-START.md` (guÃ­a rÃ¡pida)
- `supabase/migrations/001_core_schema.sql`
- `supabase/migrations/002_storage_policies.sql`

**VerificaciÃ³n exitosa**:
```bash
âœ… npm run dev funciona
âœ… Signup crea usuario en Supabase
âœ… Email de confirmaciÃ³n llega
âœ… Login redirige a /dashboard
âœ… No hay errores en consola
```

**Output esperado**: Supabase 100% configurado y testeado

---

### **SesiÃ³n 2: IntegraciÃ³n eco-packer (2-3 horas)** ğŸ• Tarde

**Prioridad**: ğŸ”¥ ALTA

**Contexto**: eco-packer ya estÃ¡ mejorado con tus fixes de la maÃ±ana (multi-signature, error handling, etc.)

#### **Tarea 2.1: Integrar en generate-link.ts** (1 hora)

**Archivo**: `netlify/functions/generate-link.ts`

**QuÃ© hacer**:
1. Importar eco-packer
2. Generar par de llaves Ed25519 (o usar llaves pre-generadas del owner)
3. Calcular SHA256 de assets
4. Llamar a `pack()` para crear .ecox
5. Subir .ecox a Supabase Storage (bucket: ecox-files)
6. Opcional: Generar .eco pÃºblico con `packEcoFromEcoX()`

**CÃ³digo aproximado**:
```typescript
import { pack, packEcoFromEcoX } from '@vistapulse/eco-packer';
import { generateEd25519KeyPair, sha256Hex } from '@vistapulse/eco-packer/eco-utils';

// En generate-link handler:
const { privateKey, publicKey } = generateEd25519KeyPair();

const project: EcoProject = {
  id: document.id,
  name: document.title,
  assets: {
    'asset-1': {
      id: 'asset-1',
      mediaType: 'document',
      fileName: document.original_filename,
      // ... mÃ¡s campos
    }
  },
  timeline: [], // Si aplica
  createdAt: Date.now(),
  updatedAt: Date.now(),
  version: '1.0.0'
};

const assetHashes = new Map();
assetHashes.set('asset-1', document.eco_hash);

const ecoxBuffer = await pack(project, assetHashes, {
  privateKey,
  keyId: user.id // tenant-specific key
});

// Subir a Storage
const { data, error } = await supabase.storage
  .from('ecox-files')
  .upload(`${user.id}/${document.id}.ecox`, ecoxBuffer);
```

**DesafÃ­os**:
- âš ï¸ eco-packer usa Node.js `crypto` (puede no funcionar en Netlify Functions browser context)
- ğŸ’¡ SoluciÃ³n: Usar Netlify Edge Functions o backend separado
- ğŸ’¡ Alternativa: Pre-generar .ecox en client y solo validar en backend

**DecisiÃ³n requerida**: Â¿Generar .ecox en client o en backend?

---

#### **Tarea 2.2: Testing de generaciÃ³n** (30 min)

**QuÃ© testear**:
1. Subir archivo PDF â†’ DeberÃ­a crear documento en DB
2. Generar link NDA â†’ DeberÃ­a crear .ecox firmado
3. Descargar .ecox â†’ DeberÃ­a ser vÃ¡lido
4. Verificar firma con `unpack()` â†’ DeberÃ­a validar correctamente

**Comando**:
```bash
cd netlify
npm run build  # Verificar que compila
netlify dev    # Levantar functions local
```

**Endpoint a probar**:
```bash
curl -X POST http://localhost:8888/.netlify/functions/generate-link \
  -H "Authorization: Bearer YOUR_JWT" \
  -H "X-CSRF-Token: YOUR_CSRF" \
  -H "Content-Type: application/json" \
  -d '{
    "document_id": "test-doc-123",
    "recipient_email": "test@example.com",
    "expires_in_hours": 24,
    "require_nda": true
  }'
```

**Output esperado**: Link generado + .ecox subido a Storage

---

### **SesiÃ³n 3: Testing E2E (1-2 horas)** ğŸŒ™ Noche (opcional)

**Prioridad**: ğŸŸ¡ MEDIA (si SesiÃ³n 1 y 2 funcionan)

**Flujo completo a testear**:

#### **3.1 Flujo Owner (Certificador)**
1. âœ… Signup â†’ Email â†’ Confirmar â†’ Login
2. âœ… Upload documento (.pdf o archivo real)
3. âœ… Generar link NDA con expiraciÃ³n
4. âœ… Ver link generado en dashboard
5. âœ… Copiar access_url

#### **3.2 Flujo Recipient (Invitado)**
1. âœ… Abrir access_url (modo incÃ³gnito)
2. âœ… Ver NDA â†’ Aceptar + Firma
3. âœ… Desbloquear documento
4. âœ… Ver/Descargar .eco

#### **3.3 Flujo AuditorÃ­a**
1. âœ… Owner ve eventos de acceso en dashboard
2. âœ… Ver timestamp, IP, user agent
3. âœ… Export CSV (futuro)

**Testing manual**: 20-30 min por flujo

**Bugs esperados**: 5-10 (normal en E2E)

---

## ğŸ“‹ Checklist Detallado del DÃ­a

### **MaÃ±ana** â˜•

- [ ] **9:00-9:30**: CafÃ© + Revisar SUPABASE-QUICK-START.md
- [ ] **9:30-10:00**: Ejecutar SQL migrations en Supabase
- [ ] **10:00-10:30**: Crear buckets + configurar SMTP
- [ ] **10:30-11:00**: Copiar credenciales + testing signup/login
- [ ] **11:00-11:30**: Fix de cualquier error encontrado

**Checkpoint 11:30**: âœ… Supabase funcional o âŒ debugging

---

### **Tarde** ğŸ•

- [ ] **14:00-14:30**: Revisar arquitectura eco-packer + decidir client vs backend
- [ ] **14:30-15:30**: Implementar integraciÃ³n en generate-link.ts
- [ ] **15:30-16:00**: Build + fix errores TypeScript
- [ ] **16:00-16:30**: Testing local de generaciÃ³n de .ecox
- [ ] **16:30-17:00**: Ajustes + optimizaciones

**Checkpoint 17:00**: âœ… .ecox se genera correctamente o âŒ debugging

---

### **Noche (Opcional)** ğŸŒ™

- [ ] **19:00-19:30**: Testing E2E flujo owner
- [ ] **19:30-20:00**: Testing E2E flujo recipient
- [ ] **20:00-20:30**: Fix bugs encontrados
- [ ] **20:30-21:00**: Deploy a Netlify staging (si todo funciona)

**Checkpoint 21:00**: âœ… E2E completo funciona o ğŸ“ lista de bugs

---

## ğŸ¯ Objetivos MÃ­nimos (Must-Have)

Al final del dÃ­a DEBES tener:

1. âœ… **Supabase configurado** y signup/login funcionando
2. âœ… **eco-packer integrado** (aunque sea versiÃ³n bÃ¡sica)
3. âœ… **1 .ecox generado** exitosamente (proof of concept)

**Con esto**: TendrÃ­as MVP funcional end-to-end

---

## ğŸš€ Objetivos Stretch (Nice-to-Have)

Si sobra tiempo:

4. âœ… Testing E2E completo (owner + recipient)
5. âœ… Dashboard mostrando documentos reales
6. âœ… Eventos de auditorÃ­a registrÃ¡ndose
7. âœ… Deploy a staging

---

## âš ï¸ Riesgos y Mitigaciones

### **Riesgo 1**: eco-packer no funciona en Netlify Functions

**Probabilidad**: ğŸŸ¡ Media (usa Node.js crypto)

**MitigaciÃ³n**:
- Plan A: Usar Netlify Edge Functions (Deno runtime)
- Plan B: Generar .ecox en client (React) y solo validar en backend
- Plan C: Usar backend separado (Express.js en Railway/Render)

**Tiempo de contingencia**: +2 horas

---

### **Riesgo 2**: SMTP no funciona (emails no llegan)

**Probabilidad**: ğŸŸ¢ Baja (Gmail es confiable)

**MitigaciÃ³n**:
- Plan A: Usar Gmail App Password (mÃ¡s fÃ¡cil)
- Plan B: Usar Resend (mÃ¡s profesional)
- Plan C: Deshabilitar confirmaciÃ³n de email temporalmente (solo dev)

**Tiempo de contingencia**: +30 min

---

### **Riesgo 3**: Bugs en E2E (flujo no funciona completo)

**Probabilidad**: ğŸ”´ Alta (es normal en integraciones)

**MitigaciÃ³n**:
- Debugging sistemÃ¡tico con console.logs
- Revisar Network tab en DevTools
- Verificar Supabase Logs (Auth + Database + Storage)
- Usar Postman/curl para aislar problemas

**Tiempo de contingencia**: +1-2 horas

---

## ğŸ› ï¸ Herramientas que NecesitarÃ¡s

### **Para Debugging**:
- [ ] Chrome DevTools (Network + Console)
- [ ] Supabase Dashboard (Auth Logs + SQL Editor)
- [ ] Netlify Functions Logs
- [ ] Postman o curl para testing de API

### **Para Desarrollo**:
- [ ] VS Code con TypeScript activo
- [ ] 2 Terminales:
  - Terminal 1: `cd client && npm run dev` (Frontend)
  - Terminal 2: `cd netlify && netlify dev` (Functions)

### **Para Testing**:
- [ ] Navegador en modo incÃ³gnito (testing recipient flow)
- [ ] Email temporal (para testing signup)

---

## ğŸ“Š MÃ©tricas de Ã‰xito

Al final del dÃ­a:

| MÃ©trica | Target | CrÃ­tico |
|---------|--------|---------|
| Supabase funcionando | âœ… 100% | SÃ­ |
| eco-packer integrado | âœ… PoC | SÃ­ |
| .ecox generado | âœ… Al menos 1 | SÃ­ |
| Signup/Login | âœ… Funciona | SÃ­ |
| E2E completo | âœ… Funciona | No (nice-to-have) |
| Deploy staging | âœ… Deployado | No (opcional) |

**MÃ­nimo aceptable**: Primeras 4 mÃ©tricas âœ…

**Ã‰xito total**: Todas las mÃ©tricas âœ…

---

## ğŸ¤” Decisiones que Tomar MaÃ±ana

### **DecisiÃ³n 1**: Â¿Client-side o Server-side eco-packer?

**OpciÃ³n A: Server-side** (Netlify Functions)
- âœ… Pro: Llaves privadas mÃ¡s seguras
- âŒ Con: Puede no funcionar en Functions (Node.js crypto)
- â±ï¸ Tiempo: +2h (si hay problemas)

**OpciÃ³n B: Client-side** (React)
- âœ… Pro: Funciona seguro (browser crypto API)
- âŒ Con: Llaves en client (menos seguro pero aceptable)
- â±ï¸ Tiempo: 1h

**RecomendaciÃ³n**: Empezar con **OpciÃ³n B** (client-side) para velocidad, luego migrar a server-side si es necesario.

---

### **DecisiÃ³n 2**: Â¿Gmail o Resend para SMTP?

**OpciÃ³n A: Gmail**
- âœ… Pro: Setup en 2 minutos
- âŒ Con: LÃ­mite 100 emails/dÃ­a
- ğŸ¯ Uso: Development + testing

**OpciÃ³n B: Resend**
- âœ… Pro: 100 emails/dÃ­a gratis, profesional
- âŒ Con: Requiere dominio verificado (puede tardar)
- ğŸ¯ Uso: Production

**RecomendaciÃ³n**: Empezar con **Gmail** (rÃ¡pido), luego cambiar a **Resend** cuando deploys a producciÃ³n.

---

## ğŸ“ Plan de Contingencia

### **Si a las 12:00 Supabase NO funciona**:

1. STOP - No avanzar con eco-packer
2. Revisar SUPABASE-SETUP-CHECKLIST.md paso a paso
3. Pedir ayuda (Claude Code, Discord de Supabase, etc.)
4. Tiempo mÃ¡ximo debugging: 1 hora
5. Si sigue sin funcionar â†’ Usar Supabase CLI local

---

### **Si a las 17:00 eco-packer NO funciona en Functions**:

1. Pivotar a client-side generation
2. Simplificar: Solo generar manifest, skip firma temporalmente
3. Mock el .ecox si es necesario para seguir con E2E
4. Volver a integraciÃ³n real despuÃ©s

---

## ğŸ‰ Recompensas por Milestone

- âœ… **Supabase funcionando**: CafÃ© premium â˜•
- âœ… **eco-packer integrado**: Cerveza ğŸº
- âœ… **E2E completo**: CelebraciÃ³n grande ğŸŠ

---

## ğŸ“š Recursos Disponibles

### **DocumentaciÃ³n Creada**:
- `SUPABASE-QUICK-START.md` - Setup rÃ¡pido (15 min)
- `SUPABASE-SETUP-CHECKLIST.md` - Setup completo (45 min)
- `LOCAL-DEV.md` - GuÃ­a de desarrollo local
- `ROBUSTNESS.md` - Error handling implementado
- `DEPLOYMENT.md` - GuÃ­a de deploy a producciÃ³n

### **SQL Ready**:
- `supabase/migrations/001_core_schema.sql`
- `supabase/migrations/002_storage_policies.sql`

### **Code Ready**:
- Frontend: 100% completo (Auth, ErrorBoundary, API client)
- Backend: 4 Functions bÃ¡sicas (falta integrar eco-packer)
- eco-packer: Mejorado con tus fixes de hoy

---

## ğŸ¯ Siguiente SesiÃ³n (11-11)

Si completamos todo maÃ±ana, el dÃ­a siguiente serÃ­a:

**Semana 2 - Backend Real Funcional**:
- OpenTimestamps integration (anclaje Bitcoin)
- Watermark dinÃ¡mico en viewer
- Dashboard de accesos con export CSV
- OTP 2FA (opcional)

---

## ğŸ’¡ Tips Finales

1. **Empezar temprano** - La integraciÃ³n siempre tarda mÃ¡s de lo esperado
2. **No optimizar prematuramente** - Primero que funcione, luego mejora
3. **Commitear frecuentemente** - Cada milestone pequeÃ±o
4. **Testing manual primero** - Antes de automatizar
5. **Si algo no funciona en 30 min** - Buscar alternativa

---

## âœ… Checklist Pre-Arranque (Ahora Mismo)

Antes de dormir, verifica:

- [x] SUPABASE-QUICK-START.md estÃ¡ listo âœ…
- [x] Credenciales de Supabase accesibles (Settings > API) âœ…
- [x] .env.example tiene todas las variables âœ…
- [x] SQL migrations estÃ¡n en supabase/migrations/ âœ…
- [x] Push a main completado (punto de retorno) âœ…

**Todo listo** âœ…

---

## ğŸ¯ Resumen Ultra-Compacto

```
MAÃ‘ANA:
1. â˜• Configurar Supabase (1-2h)
2. ğŸ• Integrar eco-packer (2-3h)
3. ğŸŒ™ Testing E2E (1-2h opcional)

MUST-HAVE:
âœ… Supabase funcional
âœ… .ecox generado (1 prueba)

NICE-TO-HAVE:
âœ… E2E completo
âœ… Deploy staging

TIEMPO TOTAL: 4-6 horas
```

---

**Â¡Buena suerte maÃ±ana!** ğŸš€

**Ãšltima actualizaciÃ³n**: 2025-11-09 21:00
